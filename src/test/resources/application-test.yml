# Test Profile Configuration
# This profile uses PostgreSQL via Testcontainers for proper array/jsonb support

spring:
  application:
    name: spring-boot-documentation-mcp-server-test

  # PostgreSQL configuration - will be overridden by Testcontainers
  datasource:
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: true

  # Disable Flyway for tests - use JPA auto-ddl + custom init script
  flyway:
    enabled: false

  # Disable Thymeleaf caching
  thymeleaf:
    cache: false

  security:
    user:
      name: admin
      password: admin
      roles: ADMIN

  # Spring AI MCP Server Configuration for tests
  # Using Streamable-HTTP protocol (MCP spec 2025-11-25)
  ai:
    mcp:
      server:
        protocol: STREAMABLE
        name: "spring-documentation-server-test"
        type: SYNC
        version: "1.8.0-test"
        request-timeout: 30s
        tool-change-notification: true
        streamable-http:
          mcp-endpoint: /mcp/spring
          keep-alive-interval: 5s
        capabilities:
          tool: true
          completion: false
          prompt: false
          resource: false

server:
  port: 0  # Random port for tests

# MCP Server Configuration (custom application settings)
mcp:
  server:
    name: "Spring Documentation MCP Server (Test)"
    version: "1.8.0-test"
    streamable-http:
      request-timeout: 30000
      keep-alive-interval: 5000

  documentation:
    bootstrap:
      enabled: false
      on-startup: false

  features:
    openrewrite:
      enabled: true
      sync:
        enabled: false
    language-evolution:
      enabled: true
      sync:
        enabled: false
    flavors:
      enabled: true

# GitHub - disabled for tests
github:
  api:
    token: ""
  documentation:
    enabled: false

# Test API Key Configuration
# This key can be used for testing: "test_api_key_for_mcp_testing_12345"
# BCrypt hash of the test key (generated with cost factor 12)
test:
  api-key:
    name: "test-api-key"
    # Plain text key: test_api_key_for_mcp_testing_12345
    # This hash is for verification in tests
    key-hash: "$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewKyNiLXCJw8.Mgi"
    enabled: true

# Reduced logging for tests
logging:
  level:
    root: WARN
    com.spring.mcp: INFO
    org.springframework.security: WARN
    org.springframework.ai.mcp: DEBUG
    org.hibernate.SQL: WARN
    org.testcontainers: INFO
    # Suppress expected shutdown noise (containers stop before Spring context closes)
    io.modelcontextprotocol.server.transport.WebMvcSseServerTransportProvider: OFF
    io.modelcontextprotocol.server.transport.WebMvcStreamableServerTransportProvider: OFF
    com.zaxxer.hikari.pool.PoolBase: OFF
    com.zaxxer.hikari.pool.HikariPool: OFF
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper: OFF
    org.springframework.beans.factory.support.DisposableBeanAdapter: OFF
